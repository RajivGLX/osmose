<div class="dashboard-wrapper d-flex">
    <div class="erp dashboard-container d-flex flex-column">
        <div class="entete-recap erp">
            <div class="picto-title">
                <div class="picto">
                    <svg xmlns="http://www.w3.org/2000/svg" id="Layer_1" data-name="Layer 1" viewBox="0 0 24 24">
                        <path d="m8,11h-3c-.552,0-1-.448-1-1s.448-1,1-1h3c.552,0,1,.448,1,1s-.448,1-1,1Zm15.759,12.651c-.198.23-.478.349-.76.349-.23,0-.462-.079-.65-.241l-2.509-2.151c-1.041.868-2.379,1.391-3.84,1.391-3.314,0-6-2.686-6-6s2.686-6,6-6,6,2.686,6,6c0,1.13-.318,2.184-.862,3.087l2.513,2.154c.419.359.468.991.108,1.41Zm-6.78-4.325l2.703-2.614c.398-.383.411-1.016.029-1.414-.383-.399-1.017-.41-1.414-.029l-2.713,2.624c-.143.141-.379.144-.522.002l-1.354-1.331c-.396-.388-1.028-.381-1.414.014-.387.395-.381,1.027.014,1.414l1.354,1.332c.46.449,1.062.674,1.663.674s1.201-.225,1.653-.671Zm-5.979,3.674c0,.552-.448,1-1,1h-5c-2.757,0-5-2.243-5-5V5C0,2.243,2.243,0,5,0h4.515c1.87,0,3.627.728,4.95,2.05l3.485,3.485c.888.888,1.521,2,1.833,3.217.077.299.011.617-.179.861s-.481.387-.79.387h-5.813c-1.654,0-3-1.346-3-3V2.023c-.16-.015-.322-.023-.485-.023h-4.515c-1.654,0-3,1.346-3,3v14c0,1.654,1.346,3,3,3h5c.552,0,1,.448,1,1Zm1-16c0,.551.449,1,1,1h4.338c-.219-.382-.489-.736-.803-1.05l-3.485-3.485c-.318-.318-.671-.587-1.05-.806v4.341Zm-5,6h-2c-.552,0-1,.448-1,1s.448,1,1,1h2c.552,0,1-.448,1-1s-.448-1-1-1Zm0,4h-2c-.552,0-1,.448-1,1s.448,1,1,1h2c.552,0,1-.448,1-1s-.448-1-1-1Z"/>
                    </svg>
                </div>
                <span class="fw-bold">Liste de tâches</span>
            </div>
            <div class="add-action" (click)="toggleTaskForm()">
                <svg id="Layer_1" viewBox="0 0 24 24" >
                    <path d="m12 0a12 12 0 1 0 12 12 12.013 12.013 0 0 0 -12-12zm4 13h-3v3a1 1 0 0 1 -2 0v-3h-3a1 1 0 0 1 0-2h3v-3a1 1 0 0 1 2 0v3h3a1 1 0 0 1 0 2z"/>
                </svg>
                <span>Créer</span>
            </div>
            <!-- Formulaire avec classe conditionnelle pour l'affichage -->
            <div class="task-form-container" [class.expanded]="isTaskFormVisible">
                <form [formGroup]="taskForm" class="task-form" (ngSubmit)="onSubmitTask()">
                    <div class="form-content">
                        <mat-form-field appearance="outline" class="full-width">
                            <mat-label>Description de la tâche</mat-label>
                            <input matInput formControlName="description" placeholder="Entrez votre tâche..."
                                   #taskInput>
                            <mat-error appFormError="description">La description est requise</mat-error>
                        </mat-form-field>
                        <button type="submit" class="btn custom-btn primary" [disabled]="taskForm.invalid || isLoading">
                            @if (isLoading) {
                                <mat-spinner diameter="20"></mat-spinner>
                            } @else {
                                <span>Ajouter</span>
                            }
                        </button>
                    </div>
                </form>
            </div>
        </div>

        <div class="wrapper-listing">
            @if (!loaderTasks()) {
                @if (tasks && tasks.length > 0) {
                    <div class="task-list">
                        @for (task of tasks; track task.id) {
                            <div class="task-item"
                                 [class.completed]="task.checked"
                                 [attr.data-task-id]="task.id">
                                <span class="task-description">{{ task.description }}</span>
                                <mat-checkbox
                                        [checked]="task.checked"
                                        [disabled]="task.checked"
                                        (change)="updateTaskStatus(task, $event.checked)">
                                </mat-checkbox>
                            </div>
                        }
                    </div>
                } @else {
                    <div class="empty-tasks">
                        Aucune tâche à afficher
                    </div>
                }
            } @else {
                <div class="loading-tasks">
                    <mat-spinner diameter="60"></mat-spinner>
                </div>
            }
        </div>
    </div>

    <div class="urbanisme dashboard-container d-flex flex-column">
        <div class="entete-recap urbanisme">
            <div class="picto-title">
                <div class="picto">
                    <svg id="Layer_1" viewBox="0 0 24 24">
                        <path d="m11 12a1 1 0 0 1 0 2h-3a1 1 0 0 1 0-2zm6-3a1 1 0 0 0 -1-1h-8a1 1 0 0 0 0 2h8a1 1 0 0 0 1-1zm-9-3h8a1 1 0 0 0 0-2h-8a1 1 0 0 0 0 2zm12 13.444v3.833a.721.721 0 0 1 -1.231.51l-.769-.768-.769.768a.721.721 0 0 1 -1.231-.51v-3.833a3.987 3.987 0 0 1 2-7.444 3.939 3.939 0 0 1 1 .142v-7.142a3 3 0 0 0 -3-3h-8a3 3 0 0 0 -3 3v12a3 3 0 0 0 3 3h5a1 1 0 0 1 0 2h-5a5.006 5.006 0 0 1 -5-5v-12a5.006 5.006 0 0 1 5-5h8a5.006 5.006 0 0 1 5 5v8.382a3.95 3.95 0 0 1 -1 6.062zm0-3.444a2 2 0 1 0 -2 2 2 2 0 0 0 2-2z"/>
                    </svg>
                </div>
                <span class="fw-bold">
                    Créer un locataire
                </span>

            </div>
            <a routerLink="/locataire-create">
                <div class="add-action erp">
                    <svg id="Layer_1" viewBox="0 0 24 24" >
                        <path d="m12 0a12 12 0 1 0 12 12 12.013 12.013 0 0 0 -12-12zm4 13h-3v3a1 1 0 0 1 -2 0v-3h-3a1 1 0 0 1 0-2h3v-3a1 1 0 0 1 2 0v3h3a1 1 0 0 1 0 2z"/>
                    </svg>
                    <span>
                        Créer
                    </span>

                </div>
            </a>
        </div>

        <div class="wrapper-listing urbanisme">
            <div class="wrapper-cta-listing">
                <a routerLink="/historique-urbanisme">
                    <button class="btn custom-btn">Tout afficher</button>
                </a>
            </div>

            <div class="body-listing urbanisme empty">
                <div class="empty">
                    <span>
                        <svg id="Layer_1" viewBox="0 0 24 24">
                            <path d="m17.994 2.286a9 9 0 0 0 -14.919 5.536 8.938 8.938 0 0 0 2.793 7.761 6.263 6.263 0 0 1 2.132 4.566v.161a3.694 3.694 0 0 0 3.69 3.69h.62a3.694 3.694 0 0 0 3.69-3.69v-.549a5.323 5.323 0 0 1 1.932-4 8.994 8.994 0 0 0 .062-13.477zm-5.684 19.714h-.62a1.692 1.692 0 0 1 -1.69-1.69s-.007-.26-.008-.31h4.008v.31a1.692 1.692 0 0 1 -1.69 1.69zm4.3-7.741a7.667 7.667 0 0 0 -2.364 3.741h-1.246v-7.184a3 3 0 0 0 2-2.816 1 1 0 0 0 -2 0 1 1 0 0 1 -2 0 1 1 0 0 0 -2 0 3 3 0 0 0 2 2.816v7.184h-1.322a8.634 8.634 0 0 0 -2.448-3.881 7 7 0 0 1 3.951-12.073 7.452 7.452 0 0 1 .828-.046 6.921 6.921 0 0 1 4.652 1.778 6.993 6.993 0 0 1 -.048 10.481z"/>
                        </svg>
                    </span>
                    <div class="cta-new-demande erp">
                        <a routerLink="/erp">
                            <button class="btn custom-btn">
                                Voir mon centre
                            </button>
                        </a>
                    </div>
                </div>
            </div>

            <div class="body-listing urbanisme">

            </div>

        </div>
    </div>
</div>
